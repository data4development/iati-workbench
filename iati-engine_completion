# add command line autocompletion for iati-engine:
# include executable files from home/bin as well as Ant targets

# create a list of commands in the bin directory
# note: adding spaces before and after the name, to simplify testing for whole words later
export _iati_engine_commands=`find $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/docker/iati-engine/bin/ -executable -type f -printf " %f "`
export _iati_engine_targets=`iati-engine ant -p -q | grep ^\  | cut -f 2 -d \ `

_iati_engine_spreadsheets="xls xlsx csv ods xml"

_iati-engine()
{
  local cur opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"
  prev2="${COMP_WORDS[COMP_CWORD-2]}"

  case "${prev}" in
      show|val-act|val-org)
        _filedir
        return 0
        ;;
      convert)
        COMPREPLY=( $(compgen -W "$_iati_engine_spreadsheets" -- ${cur} ) )
        return 0
        ;;
      *)
        case "${prev2}" in
          convert)
            _filedir
            return 0
            ;;
          *)
          ;;
        esac
      ;;
  esac

  COMPREPLY=( $(compgen -W "${_iati_engine_commands} ${_iati_engine_targets}" -- ${cur}) )
}
complete -F _iati-engine iati-engine
