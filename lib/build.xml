<?xml version="1.0" encoding="UTF-8"?>
<project>
  <description>
    Library of build information.
  </description>

  <!-- Pattern to work with BaseX as XQuery processor. -->
  <macrodef name="basexpipe">
    <attribute name="xquery"/>
    <attribute name="src" default="/workspace/tmp"/>
    <attribute name="from"/>
    <attribute name="fromP" default="@from"/>
    <attribute name="dest" default="/workspace/tmp"/>
    <attribute name="to"/>
    <attribute name="toP" default="@to"/>
    <sequential>
      <dependset>
        <sources>
          <file file="@{xquery}"/>
        </sources>
        <targetfileset dir="@{dest}">
          <patternset>
            <include name="@{to}"/>
          </patternset>
        </targetfileset>
      </dependset>
      <apply executable="basex" dest="@{dest}" verbose="true">
        <arg value="-i"/>
        <srcfile/>
        <arg value="-o"/>
        <targetfile/>
        <arg value="@{xquery}"/>
        <fileset dir="@{src}" includes="@{from}"/>
        <mapper type="glob" from="@{from}" to="@{to}"/>
      </apply>
    </sequential>
  </macrodef>

  <!-- Create a listing of the tmp directory for further XSLT processing -->
  <target name="ls-tmp" depends="init">
    <apply executable="xmlstarlet" output="/workspace/tmp/ls.xml">
      <arg line="ls"/>
      <dirset dir="/workspace" includes="tmp"/>
      <!-- TODO: test this, should be dir=workspace, includes=tmp? -->
    </apply>
  </target>
</project>
